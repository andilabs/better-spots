{% extends "base.html" %}

{% load bootstrap3 %}

{% block extra_head %}
    {{ form.media }}
{% endblock %}

{% block content %}
{% load instance_settings_via_tags %}


<!-- Modal -->
<div class="modal fade" id="rating-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h2 class="modal-title" id="myModalLabel">
                <span class="glyphicon glyphicon-comment"></span> Rate it!
            </h2>
        </div>
        <div class="modal-body">
            <form id="rating-form">
                <input type="hidden" value="2" name="spot_pk">
                <div class="form-group" id="allowance">
                    <label class="control-label">Is enabled?</label><br>
                    <label class="is_not_enabled" title="NOT allowed :-(" style="opacity: 0.2;" for="is_not_enabled">
                    <input class="allowance" type="radio" value="false" id="is_not_enabled" name="is_enabled" required></label>
                    <label class="is_enabled" title="allowed ;-)" style="opacity: 0.2;" for="is_enabled">
                    <input class="allowance" type="radio" value="true" id="is_enabled" name="is_enabled" required></label>
                </div>
                <div class="form-group">
                    <label class="control-label" for="id_rating">Rate:</label>
                    <div class='rate'>
                        <span data-score="" class="rating" id=""></span>
                    </div>
                </div>
<!--                 <div class="form-group">
                    <label class="control-label" for="id_comment">Comment:</label>
                    <textarea class="form-control" id="id_comment" name="comment" placeholder="Comment" rows="5" title=""></textarea>
                </div> -->
                <div class="form-group">
                    <label class="control-label" for="id_facilities">Facilities:</label>
                        <table>
                            {% for element in HSTORE_SCHEMA %}
                                <tr>
                                    <td>{{element|keyvalue:'kwargs'|keyvalue:'verbose_name'}}</td>
                                    <td width="50px"></td>
                                    <td>
                                        <select name="facilities[{{element|keyvalue:'name'}}]">
                                            <option value="null" selected="selected">Unknown</option>
                                            <option value="true">Yes</option>
                                            <option value="false">No</option>
                                        </select>
                                    </td>
                                </tr>
                            {% endfor %}
                        </table>
                </div>
                <input type="submit" value="Submit" class="btn btn-success">
            </form>
        </div>
    </div>
  </div>
</div>

    <div class="row">

        <div class="col-md-9 col-md-push-3">
            <center>
            <br>
                <img src="{{ STATIC_URL }}/{% settings_value "SPOT_PROJECT_NAME" %}/certificate.png"  style="max-height: 300px">
        		<h1 style="font-family:Lato Italic"> {{spot.name}} </h1>
        		<h3 style="font-family:Nobile"> {{ spot.address_city}}, {{spot.address_street}} {{spot.address_number}}</h3>
        		<span style="font-size:48px; font-family:Lobster">is {% settings_value "SPOT_PROJECT_SUBJECT" %}-friendly spot!<br>
        		{{spot.friendly_rate|floatformat:1}}/5.0</span>
    	   </center>
        </div>
        <div class="col-md-3 col-md-pull-9">




            <ul class="list-group">
                <li class="list-group-item" style="text-align:center;">
                    <button type="button" class="btn btn-success btn-lg" data-toggle="modal" data-target="#rating-modal">
                      Rate this spot!
                    </button>
                </li>
                <li class="list-group-item">
                    <div id="map_canvas_spot_detail" style="height:260px" ></div>
                </li>
                {% if spot.phone_number %}
                <li class="list-group-item">
                    <span class="badge invert fa fa-phone fa-2x"> </span>
                     <a href='tel://{{spot.phone_number}}'>{{spot.phone_number}}</a>
                </li>
                {% endif %}

                {% if spot.email %}
                <li class="list-group-item">
                    <span class="badge invert fa fa-envelope-o fa-2x"> </span>
                    <a href='mailto:{{spot.email}}' target='_blank'>{{spot.email|truncatechars:25}}</a>
                </li>
                {% endif %}

                {% if spot.www %}
                <li class="list-group-item">
                    <span class="badge invert fa fa-link fa-2x"> </span>
                    <a href='{{spot.www}}' target='_blank'>{{spot.www|truncatechars:25}}</a>
                </li>
                {% endif %}

                {% if spot.facebook %}
                <li class="list-group-item">
                    <span class="badge invert fa fa-facebook fa-2x"> </span>
                    <a href='{{spot.facebook_url}}' target='_blank'>{{spot.facebook_url|truncatechars:25}}</a>
                </li>
                {% endif %}

                <li class="list-group-item">
                    <center>
                        <img src="{{qrcode_link}}"><br>
                        <a href='{% url 'vcard' pk=spot.pk %}'>Download vCard</a>
                    </center>
                </li>
            </ul>

        </div>
    </div>


{% endblock %}
{% block scripts %}
  {{ block.super }}
<script language="javascript"> var STATIC_URL = "/static/"; var BASE_HOST = "//{{request.META.HTTP_HOST}}"</script>

<script language="javascript">  var LAT = "{{ spot.latitude }}"; var LON = " {{ spot.longitude }}";</script>


<script type="text/javascript" src="{{ STATIC_URL }}js/spot_detail.js"></script>
<script>

window.check_it=function(foo){
  if ($(foo).prop('checked') === false) {
    $(foo).parent().css('opacity', '0.2');
  } else {
    $(foo).parent().css('opacity', '1');
  }
}

$("#rating-modal").on("click","#allowance", function(e) {
   $(this).find('input.allowance').each(function(index, element) {
        check_it(this);
    });
});

$("#rating-modal").on("click","span.rating", function(e) {
    e.stopPropagation();
});
// $("#rating-modal").on("submit","#rating-form", function(e) {
//     e.preventDefault();
//     var data  = JSON.stringify($("#rating-form").serializeJSON({parseBooleans: true, parseNulls: true, parseNumbers: true}));
//     console.log(data);

// });
</script>

{% endblock scripts %}

